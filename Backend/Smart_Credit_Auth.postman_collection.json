{
  "info": {
    "name": "Smart Credit API - Authentication",
    "description": "Complete authentication testing collection for Smart Credit API.\n\nHow to use:\n1. Import this collection into Postman\n2. Run requests in order (Register → Login → Protected routes)\n3. Tokens are saved automatically after Register/Login\n4. Protected routes use the saved token automatically",
    "_postman_id": "smart-credit-auth-collection",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "variable": [
    {
      "key": "baseUrl",
      "value": "http://localhost:3000/api",
      "type": "string"
    },
    {
      "key": "token",
      "value": "",
      "type": "string"
    }
  ],
  "item": [
    {
      "name": "1. Registration",
      "description": "Register new users with different roles. Token is saved automatically after each request.",
      "item": [
        {
          "name": "Register Borrower ✅",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "if (pm.response.code === 201) {",
                  "    const res = pm.response.json();",
                  "    pm.collectionVariables.set('token', res.access_token);",
                  "    pm.test('Registration successful', () => {",
                  "        pm.expect(res.access_token).to.be.a('string');",
                  "        pm.expect(res.user.email).to.eql('borrower@test.com');",
                  "        pm.expect(res.user.role).to.eql('borrower');",
                  "    });",
                  "    console.log('Token saved automatically!');",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"borrower@test.com\",\n  \"password\": \"Borrower@123\",\n  \"role\": \"borrower\"\n}",
              "options": { "raw": { "language": "json" } }
            },
            "url": {
              "raw": "{{baseUrl}}/auth/register",
              "host": ["{{baseUrl}}"],
              "path": ["auth", "register"]
            }
          }
        },
        {
          "name": "Register Lender ✅",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "if (pm.response.code === 201) {",
                  "    const res = pm.response.json();",
                  "    pm.collectionVariables.set('token', res.access_token);",
                  "    pm.test('Lender registered', () => {",
                  "        pm.expect(res.user.role).to.eql('lender');",
                  "    });",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"lender@test.com\",\n  \"password\": \"Lender@123\",\n  \"role\": \"lender\"\n}",
              "options": { "raw": { "language": "json" } }
            },
            "url": {
              "raw": "{{baseUrl}}/auth/register",
              "host": ["{{baseUrl}}"],
              "path": ["auth", "register"]
            }
          }
        },
        {
          "name": "Register Admin ✅",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "if (pm.response.code === 201) {",
                  "    const res = pm.response.json();",
                  "    pm.collectionVariables.set('token', res.access_token);",
                  "    pm.test('Admin registered', () => {",
                  "        pm.expect(res.user.role).to.eql('admin');",
                  "    });",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"admin@test.com\",\n  \"password\": \"Admin@1234\",\n  \"role\": \"admin\"\n}",
              "options": { "raw": { "language": "json" } }
            },
            "url": {
              "raw": "{{baseUrl}}/auth/register",
              "host": ["{{baseUrl}}"],
              "path": ["auth", "register"]
            }
          }
        }
      ]
    },
    {
      "name": "2. Login",
      "description": "Login with registered users. Token is saved automatically.",
      "item": [
        {
          "name": "Login as Borrower ✅",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "if (pm.response.code === 200) {",
                  "    const res = pm.response.json();",
                  "    pm.collectionVariables.set('token', res.access_token);",
                  "    pm.test('Login successful', () => {",
                  "        pm.expect(res.access_token).to.be.a('string');",
                  "        pm.expect(res.user.email).to.eql('borrower@test.com');",
                  "    });",
                  "    console.log('Token saved! Protected routes will use it automatically.');",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"borrower@test.com\",\n  \"password\": \"Borrower@123\"\n}",
              "options": { "raw": { "language": "json" } }
            },
            "url": {
              "raw": "{{baseUrl}}/auth/login",
              "host": ["{{baseUrl}}"],
              "path": ["auth", "login"]
            }
          }
        },
        {
          "name": "Login as Lender ✅",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "if (pm.response.code === 200) {",
                  "    const res = pm.response.json();",
                  "    pm.collectionVariables.set('token', res.access_token);",
                  "    pm.test('Lender login successful', () => {",
                  "        pm.expect(res.user.role).to.eql('lender');",
                  "    });",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"lender@test.com\",\n  \"password\": \"Lender@123\"\n}",
              "options": { "raw": { "language": "json" } }
            },
            "url": {
              "raw": "{{baseUrl}}/auth/login",
              "host": ["{{baseUrl}}"],
              "path": ["auth", "login"]
            }
          }
        },
        {
          "name": "Login as Admin ✅",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "if (pm.response.code === 200) {",
                  "    const res = pm.response.json();",
                  "    pm.collectionVariables.set('token', res.access_token);",
                  "    pm.test('Admin login successful', () => {",
                  "        pm.expect(res.user.role).to.eql('admin');",
                  "    });",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"admin@test.com\",\n  \"password\": \"Admin@1234\"\n}",
              "options": { "raw": { "language": "json" } }
            },
            "url": {
              "raw": "{{baseUrl}}/auth/login",
              "host": ["{{baseUrl}}"],
              "path": ["auth", "login"]
            }
          }
        },
        {
          "name": "Login - Wrong Password ❌",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Should return 401 Unauthorized', () => {",
                  "    pm.expect(pm.response.code).to.eql(401);",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"borrower@test.com\",\n  \"password\": \"WrongPassword@123\"\n}",
              "options": { "raw": { "language": "json" } }
            },
            "url": {
              "raw": "{{baseUrl}}/auth/login",
              "host": ["{{baseUrl}}"],
              "path": ["auth", "login"]
            }
          }
        },
        {
          "name": "Login - User Not Found ❌",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Should return 401 Unauthorized', () => {",
                  "    pm.expect(pm.response.code).to.eql(401);",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"nobody@test.com\",\n  \"password\": \"Test@1234\"\n}",
              "options": { "raw": { "language": "json" } }
            },
            "url": {
              "raw": "{{baseUrl}}/auth/login",
              "host": ["{{baseUrl}}"],
              "path": ["auth", "login"]
            }
          }
        }
      ]
    },
    {
      "name": "3. Protected Routes",
      "description": "These routes require a valid JWT token. The token from Register/Login is used automatically.",
      "item": [
        {
          "name": "Borrower Profile - With Token ✅",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Should return 200 with user data', () => {",
                  "    pm.expect(pm.response.code).to.eql(200);",
                  "    const res = pm.response.json();",
                  "    pm.expect(res.user).to.have.property('email');",
                  "    pm.expect(res.user).to.have.property('role');",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [],
            "auth": {
              "type": "bearer",
              "bearer": [
                {
                  "key": "token",
                  "value": "{{token}}",
                  "type": "string"
                }
              ]
            },
            "url": {
              "raw": "{{baseUrl}}/borrower/profile",
              "host": ["{{baseUrl}}"],
              "path": ["borrower", "profile"]
            }
          }
        },
        {
          "name": "Borrower Profile - No Token ❌ (Should Fail)",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Should return 401 Unauthorized', () => {",
                  "    pm.expect(pm.response.code).to.eql(401);",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [],
            "auth": {
              "type": "noauth"
            },
            "url": {
              "raw": "{{baseUrl}}/borrower/profile",
              "host": ["{{baseUrl}}"],
              "path": ["borrower", "profile"]
            }
          }
        },
        {
          "name": "Borrower Profile - Invalid Token ❌ (Should Fail)",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Should return 401 Unauthorized', () => {",
                  "    pm.expect(pm.response.code).to.eql(401);",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [],
            "auth": {
              "type": "bearer",
              "bearer": [
                {
                  "key": "token",
                  "value": "this.is.a.fake.token.12345",
                  "type": "string"
                }
              ]
            },
            "url": {
              "raw": "{{baseUrl}}/borrower/profile",
              "host": ["{{baseUrl}}"],
              "path": ["borrower", "profile"]
            }
          }
        }
      ]
    },
    {
      "name": "4. Validation Tests",
      "description": "These requests should all FAIL with 400 Bad Request - demonstrates input validation.",
      "item": [
        {
          "name": "Register - Invalid Email ❌",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Should return 400 Bad Request', () => {",
                  "    pm.expect(pm.response.code).to.eql(400);",
                  "    const res = pm.response.json();",
                  "    pm.expect(res.message).to.be.an('array');",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"not-a-valid-email\",\n  \"password\": \"Test@1234\",\n  \"role\": \"borrower\"\n}",
              "options": { "raw": { "language": "json" } }
            },
            "url": {
              "raw": "{{baseUrl}}/auth/register",
              "host": ["{{baseUrl}}"],
              "path": ["auth", "register"]
            }
          }
        },
        {
          "name": "Register - Weak Password (too short) ❌",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Should return 400 for weak password', () => {",
                  "    pm.expect(pm.response.code).to.eql(400);",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"weak@test.com\",\n  \"password\": \"short\",\n  \"role\": \"borrower\"\n}",
              "options": { "raw": { "language": "json" } }
            },
            "url": {
              "raw": "{{baseUrl}}/auth/register",
              "host": ["{{baseUrl}}"],
              "path": ["auth", "register"]
            }
          }
        },
        {
          "name": "Register - No Special Char in Password ❌",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Should return 400 for missing special char', () => {",
                  "    pm.expect(pm.response.code).to.eql(400);",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"nospecial@test.com\",\n  \"password\": \"TestPassword123\",\n  \"role\": \"borrower\"\n}",
              "options": { "raw": { "language": "json" } }
            },
            "url": {
              "raw": "{{baseUrl}}/auth/register",
              "host": ["{{baseUrl}}"],
              "path": ["auth", "register"]
            }
          }
        },
        {
          "name": "Register - Invalid Role ❌",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Should return 400 for invalid role', () => {",
                  "    pm.expect(pm.response.code).to.eql(400);",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"invalid@test.com\",\n  \"password\": \"Test@1234\",\n  \"role\": \"superuser\"\n}",
              "options": { "raw": { "language": "json" } }
            },
            "url": {
              "raw": "{{baseUrl}}/auth/register",
              "host": ["{{baseUrl}}"],
              "path": ["auth", "register"]
            }
          }
        },
        {
          "name": "Register - Missing Password ❌",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Should return 400 for missing password', () => {",
                  "    pm.expect(pm.response.code).to.eql(400);",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"nopwd@test.com\",\n  \"role\": \"borrower\"\n}",
              "options": { "raw": { "language": "json" } }
            },
            "url": {
              "raw": "{{baseUrl}}/auth/register",
              "host": ["{{baseUrl}}"],
              "path": ["auth", "register"]
            }
          }
        },
        {
          "name": "Register - Empty Body ❌",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Should return 400 for empty body', () => {",
                  "    pm.expect(pm.response.code).to.eql(400);",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [],
            "body": {
              "mode": "raw",
              "raw": "{}",
              "options": { "raw": { "language": "json" } }
            },
            "url": {
              "raw": "{{baseUrl}}/auth/register",
              "host": ["{{baseUrl}}"],
              "path": ["auth", "register"]
            }
          }
        },
        {
          "name": "Register - Extra Fields Rejected ❌",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Should return 400 for extra fields', () => {",
                  "    pm.expect(pm.response.code).to.eql(400);",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"extra@test.com\",\n  \"password\": \"Test@1234\",\n  \"role\": \"borrower\",\n  \"isAdmin\": true,\n  \"hack\": \"inject\"\n}",
              "options": { "raw": { "language": "json" } }
            },
            "url": {
              "raw": "{{baseUrl}}/auth/register",
              "host": ["{{baseUrl}}"],
              "path": ["auth", "register"]
            }
          }
        },
        {
          "name": "Register - Duplicate Email ❌ (Run After Registering borrower@test.com)",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Should return 409 Conflict', () => {",
                  "    pm.expect(pm.response.code).to.eql(409);",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"borrower@test.com\",\n  \"password\": \"Borrower@123\",\n  \"role\": \"borrower\"\n}",
              "options": { "raw": { "language": "json" } }
            },
            "url": {
              "raw": "{{baseUrl}}/auth/register",
              "host": ["{{baseUrl}}"],
              "path": ["auth", "register"]
            }
          }
        }
      ]
    }
  ]
}
